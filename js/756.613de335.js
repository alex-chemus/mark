"use strict";(self["webpackChunkmark"]=self["webpackChunkmark"]||[]).push([[756],{756:function(t,e,s){s.r(e),s.d(e,{default:function(){return F}});var r=s(252),a=s(262),o=s(577),n=s(562),u=s(201),i=s(235),l=s(53),p=s(933);const c=({router:t,route:e},s)=>{const r=()=>{if(!p.h.getters.roles||!p.h.state.userInfo)return;const e=p.h.getters.roles.includes("teacher");if(e&&p.h.state.userInfo.id)return void t.push({path:`/attendance/user/${p.h.state.userInfo.id}`});if(!p.h.state.institution)return;const s=p.h.getters.roles.includes("administrator_of_institution");if(s){const{teachers:e}=p.h.state.institution.additionalData.staff;e.length?t.push({path:`/attendance/user/${e[0].userID}`}):t.push({path:"/notfound"})}else t.push({path:"/notfound"})},a=()=>{if(!p.h.getters.roles||!p.h.state.userInfo||!e.path.startsWith("/attendance/user"))return;if(!e.params.userID)return void r();if(p.h.getters.roles.includes("teacher")){const t=+e.params.userID;return void(t===p.h.state.userInfo.id?s.value=!0:r())}if(!p.h.state.institution)return;const a=p.h.getters.roles.includes("administrator_of_institution");if(a){const t=+e.params.userID,{teachers:a}=p.h.state.institution.additionalData.staff;a.map((t=>t.userID)).includes(t)?s.value=!0:r()}else t.push({path:"/notfound"})};return a},h=({router:t,route:e},s)=>{const r=()=>{if(!p.h.getters.roles||!p.h.state.userInfo)return;const e=!p.h.getters.roles.includes("teacher")&&!p.h.getters.roles.includes("administrator_of_institution");if(e){const e=p.h.state.userInfo.additionalData.inGroups;e.length?t.push({path:`/attendance/group/${e[0]}`}):t.push({path:"/notfound"})}else if(p.h.state.institution)if(p.h.getters.roles.includes("administrator_of_institution")){const{groups:e}=p.h.state.institution;e.length?t.push({path:`/attendance/group/${e[0]}`}):t.push({path:"/notfound"})}else t.push({path:"/notfound"})},a=()=>{if(!p.h.getters.roles||!p.h.state.userInfo||!e.path.startsWith("/attendance/group"))return;if(!e.params.groupID)return void r();const a=!p.h.getters.roles.includes("teacher")&&!p.h.getters.roles.includes("administrator_of_institution");if(a){const t=+e.params.groupID,a=p.h.state.userInfo.additionalData.inGroups;a.includes(t)?s.value=!0:r()}else if(p.h.state.institution)if(p.h.getters.roles.includes("administrator_of_institution")){const t=+e.params.groupID,{groups:a}=p.h.state.institution;a.includes(t)?s.value=!0:r()}else t.push({path:"/notfound"})};return a},d=({router:t,route:e})=>{const s=(0,a.iH)(!1),r=c({route:e,router:t},s),o=h({route:e,router:t},s),n=()=>{e.path.startsWith("/attendance/group")&&o(),e.path.startsWith("/attendance/user")&&r()},u=[()=>p.h.getters.roles,()=>p.h.state.userInfo,()=>p.h.state.institution,()=>e.params.groupID,()=>e.params.userID];return{validate:n,isValid:s,validationDeps:u}};var f=d;const v=()=>{const t=(0,a.iH)(0),e=(0,a.iH)(!1),s=(0,a.iH)(null),r=async({groupID:r,userID:a})=>{if(!r&&!a)return;if(e.value)return;const o=()=>r?{groupID:r,limit:`${t.value},20`}:a?{sendedTo:a,limit:`${t.value},20`}:{},{response:n,error:u}=await(0,i.ib)({path:"markMethods/attendance.getAttendanceReportsInfo",data:o()});if(u)console.log(u),p.h.dispatch("setError",u);else{if(s.value||0!==n.length){if(0===n.length)return void(e.value=!0)}else s.value,e.value=!0;s.value=s.value?[...s.value,...n]:n,t.value+=20}};return{fetchReports:r,reportsInfo:s,isOver:e}};var g=v;const m=({reportsInfo:t})=>{const e=(0,a.iH)("latest"),s=(0,r.Fl)((()=>{if(!t.value)return null;const{setTime:s}=(0,l.rE)();return"latest"===e.value?t.value.map((t=>s(t))):[...t.value].reverse().map((t=>s(t)))}));return{sort:e,sortedReports:s}};var I=m;const D=t=>((0,r.dD)("data-v-3ce469c2"),t=t(),(0,r.Cn)(),t),_=n+"#tabler-arrows-sort",w=n+"#tabler-chevron-right",k={class:"sort-group"},b=D((()=>(0,r._)("svg",{class:"sort-icon",width:"24",height:"24",viewBox:"0 0 24 24"},[(0,r._)("use",{href:_})],-1))),S={key:0,class:"filter-wrapper"},U={key:0,class:"no-reports"},C={key:1,class:"reports-list"},H=D((()=>(0,r._)("svg",{width:"22",height:"22",viewBox:"0 0 22 22"},[(0,r._)("use",{href:w})],-1)));var y=(0,r.aZ)({__name:"Attendance",setup(t){const e=(0,u.tv)(),s=(0,u.yj)(),{validate:n,isValid:p,validationDeps:c}=f({route:s,router:e});(0,r.wF)(n),(0,r.YP)(c,n);const{fetchReports:h,reportsInfo:d,isOver:v}=g(),m=()=>{p.value&&(s.params.groupID?h({groupID:+s.params.groupID}):h({userID:+s.params.userID}))};(0,r.YP)([p,()=>s.params.groupID,()=>s.params.userID],m);const{sort:D,sortedReports:_}=I({reportsInfo:d}),w=(0,a.iH)(null),y=(0,r.Fl)((()=>_.value?null===w.value?_.value:_.value.filter((t=>t.groupID===w.value)):null)),$=(0,r.Fl)((()=>_.value?[...new Map(_.value.map((t=>[t.groupName,t]))).values()].map((t=>({groupName:t.groupName,groupID:t.groupID}))):null));return(0,r.wF)((()=>document.title="Посещаемость")),(t,e)=>{const n=(0,r.up)("router-link");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)((0,a.SU)(i.bZ),{text:"Отчеты закончились!",observer:(0,a.SU)(v)},null,8,["observer"]),(0,r._)("nav",null,[(0,r._)("div",k,[b,(0,r._)("button",{class:(0,o.C_)(["sort-button --mobile --no-margin","latest"===(0,a.SU)(D)?"selected":""]),onClick:e[0]||(e[0]=t=>D.value="latest")}," Новые ",2),(0,r._)("button",{class:(0,o.C_)(["sort-button --desktop","latest"===(0,a.SU)(D)?"selected":""]),onClick:e[1]||(e[1]=t=>D.value="latest")}," Сначала новые ",2),(0,r._)("button",{class:(0,o.C_)(["sort-button --desktop","oldest"===(0,a.SU)(D)?"selected":""]),onClick:e[2]||(e[2]=t=>D.value="oldest")}," Сначала старые ",2),(0,r._)("button",{class:(0,o.C_)(["sort-button --mobile","oldest"===(0,a.SU)(D)?"selected":""]),onClick:e[3]||(e[3]=t=>D.value="oldest")}," Старые ",2)]),(0,a.SU)(s).params.userID?((0,r.wg)(),(0,r.iD)("div",S,[(0,a.SU)($)?((0,r.wg)(),(0,r.j4)((0,a.SU)(l.Yh),{key:0,groups:(0,a.SU)($),currentGroupID:w.value,onSwitch:e[4]||(e[4]=t=>w.value=t)},null,8,["groups","currentGroupID"])):(0,r.kq)("",!0)])):(0,r.kq)("",!0)]),(0,a.SU)(_)&&0===(0,a.SU)(_).length?((0,r.wg)(),(0,r.iD)("div",U," У вас нет отчетов ")):(0,a.SU)(y)?((0,r.wg)(),(0,r.iD)("ul",C,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)((0,a.SU)(y),((t,e)=>((0,r.wg)(),(0,r.iD)("li",{key:e},[(0,r.Wm)(n,{to:`/report/${t.textID}`},{default:(0,r.w5)((()=>[(0,r._)("div",null,[(0,r._)("span",null,(0,o.zw)(t.date),1),(0,r._)("span",null,(0,o.zw)(t.groupName),1),(0,r._)("span",null,(0,o.zw)(t.institutionData.shortName),1)]),H])),_:2},1032,["to"])])))),128)),(0,r._)("button",{onClick:m,class:"load-button"},"Далее")])):(0,r.kq)("",!0)],64)}}}),$=s(744);const W=(0,$.Z)(y,[["__scopeId","data-v-3ce469c2"]]);var F=W}}]);
//# sourceMappingURL=756.613de335.js.map