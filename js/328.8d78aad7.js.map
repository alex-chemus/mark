{"version":3,"file":"js/328.8d78aad7.js","mappings":"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","sources":["webpack://mark/./src/pages/Invitation/hooks/useFetchInvitationInfo.ts","webpack://mark/./src/pages/Invitation/Invitation.vue?1b15","webpack://mark/./src/pages/Invitation/Invitation.vue"],"sourcesContent":["import { ref } from 'vue'\r\nimport { store } from '@/store'\r\nimport { IError, useFetch } from '@/shared'\r\nimport { IInvitationInfo } from '../types'\r\n\r\ninterface Params {\r\n  invitationID: string\r\n}\r\n\r\nconst useFetchInvitationInfo = () => {\r\n  const invitationInfo = ref<IInvitationInfo | null>(null)\r\n\r\n  const getInvitationInfo = async ({ invitationID }: Params) => {\r\n    const { response, error } = await useFetch({\r\n      path: 'markMethods/group.getInvitationInfo',\r\n      data: { invitationID }\r\n    })\r\n\r\n    if (error) {\r\n      store.dispatch('setError', error as IError)\r\n      console.log(error)\r\n    } else {\r\n      invitationInfo.value = response\r\n    }\r\n  }\r\n\r\n  return { invitationInfo, getInvitationInfo }\r\n}\r\n\r\nexport default useFetchInvitationInfo\r\n","import { defineComponent as _defineComponent } from 'vue'\nimport { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-7ce0d102\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = {\n  key: 0,\n  class: \"invitation\"\n}\nconst _hoisted_2 = { class: \"title\" }\n\nimport {\r\n  inject, onMounted, watch, ref, onBeforeMount\r\n} from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { useFetch, IError } from '@/shared'\r\nimport { useStore } from 'vuex'\r\nimport { Key } from '@/store'\r\nimport useFetchInvitationInfo from './hooks/useFetchInvitationInfo'\r\nimport { IGroupInfo } from './types'\r\n\r\n\nexport default /*#__PURE__*/_defineComponent({\n  __name: 'Invitation',\n  setup(__props) {\n\r\nconst key = inject<Key>('key')\r\nconst { dispatch, getters, state } = useStore(key)\r\n\r\nconst { params } = useRoute()\r\nconst router = useRouter()\r\n\r\nonBeforeMount(() => document.title = 'Войти в группу')\r\n\r\nonBeforeMount(() => {\r\n  if (params.id === '' || getters.roles?.includes('administrator_of_institution'))\r\n    router.push('/notfound')\r\n})\r\n\r\nconst { invitationInfo, getInvitationInfo } = useFetchInvitationInfo()\r\nonMounted(() => {\r\n  if (typeof params.id === 'string')\r\n    getInvitationInfo({ invitationID: params.id })\r\n  else\r\n    getInvitationInfo({ invitationID: params.id[0] })\r\n})\r\n\r\nconst groupInfo = ref<IGroupInfo | null>(null)\r\nconst getGroupInfo = async () => {\r\n  // for a student\r\n  if (invitationInfo.value && state.userInfo) {\r\n    if (\r\n      state.userInfo.additionalData.inGroups.includes(invitationInfo.value.groupID)\r\n      && !getters.roles.includes('teacher')\r\n    ) {\r\n      router.push({ path: '/' })\r\n      return\r\n    }\r\n  }\r\n\r\n  // for a teacher\r\n  if (invitationInfo.value && state.userInfo) {\r\n    if (\r\n      state.userInfo.additionalData.inGroups.includes(invitationInfo.value.groupID)\r\n      || state.userInfo.additionalData.ownGroups.includes(invitationInfo.value.groupID)\r\n    ) {\r\n      router.push({ path: `/groupID/${invitationInfo.value.groupID}` })\r\n      return\r\n    }\r\n  }\r\n\r\n  if (!invitationInfo.value) return\r\n  const { response, error } = await useFetch({\r\n    path: 'markMethods/group.getInfo',\r\n    data: { groupsIDs: invitationInfo.value.groupID }\r\n  })\r\n\r\n  if (error) {\r\n    dispatch('setError', error as IError)\r\n    console.log(error)\r\n  } else groupInfo.value = response[0] // eslint-disable-line\r\n}\r\nwatch([invitationInfo, () => state.userInfo], getGroupInfo)\r\n\r\nconst join = async () => {\r\n  const { error } = await useFetch({\r\n    path: 'markMethods/group.join',\r\n    data: { invitationID: params.id as string }\r\n  })\r\n\r\n  if (error) {\r\n    dispatch('setError', error as IError)\r\n    console.log(error)\r\n  } else {\r\n    await dispatch('fetchUserInfo')\r\n    await dispatch('fetchInstituion')\r\n    await dispatch('useGroups')\r\n    router.push({ path: '/' })\r\n  }\r\n}\r\n\nreturn (_ctx: any,_cache: any) => {\n  return (groupInfo.value)\n    ? (_openBlock(), _createElementBlock(\"section\", _hoisted_1, [\n        _createElementVNode(\"h6\", _hoisted_2, \"Вступить в группу \" + _toDisplayString(groupInfo.value.groupName) + \"?\", 1),\n        _createElementVNode(\"button\", {\n          class: \"button\",\n          onClick: join\n        }, \"Вступить\")\n      ]))\n    : _createCommentVNode(\"\", true)\n}\n}\n\n})","import script from \"./Invitation.vue?vue&type=script&lang=ts&setup=true\"\nexport * from \"./Invitation.vue?vue&type=script&lang=ts&setup=true\"\n\nimport \"./Invitation.vue?vue&type=style&index=0&id=7ce0d102&lang=scss&scoped=true\"\n\nimport exportComponent from \"G:\\\\Programming\\\\Apps\\\\mark\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-7ce0d102\"]])\n\nexport default __exports__"],"names":["useFetchInvitationInfo","invitationInfo","ref","getInvitationInfo","async","invitationID","response","error","useFetch","path","data","store","console","log","value","_hoisted_1","key","class","_hoisted_2","_defineComponent","__name","setup","__props","inject","dispatch","getters","state","useStore","params","useRoute","router","useRouter","onBeforeMount","document","title","id","roles","includes","push","onMounted","groupInfo","getGroupInfo","userInfo","additionalData","inGroups","groupID","ownGroups","groupsIDs","watch","join","_ctx","_cache","_openBlock","_createElementBlock","_createElementVNode","_toDisplayString","groupName","onClick","_createCommentVNode","__exports__"],"sourceRoot":""}