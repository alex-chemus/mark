{"version":3,"file":"js/804.fb2c11ed.js","mappings":"+NAWA,MAAMA,EAAe,KACnB,MAAMC,GAAaC,EAAAA,EAAAA,IAAwB,MACrCC,GAAaD,EAAAA,EAAAA,IAAmB,MAEhCE,EAAkBC,OAASC,WAAUC,cACzC,MAAM,SAAEC,EAAF,MAAYC,SAAgBC,EAAAA,EAAAA,IAAS,CACzCC,KAAM,kCACNC,KAAMN,EACF,CAAEC,UAASD,YACX,CAAEC,aAGR,GAAIE,EACFI,EAAAA,EAAAA,SAAe,WAAYJ,GAC3BK,QAAQC,IAAIN,OACP,CACLN,EAAWa,MAAQR,EAASL,WAC5B,MAAMc,EAAoB,CACxBC,QAAS,GACTC,MAAO,IAETC,OAAOC,QAAQb,EAASc,SAASC,SAASC,IACpCA,EAAK,GAAGC,WAAW,WAErBR,EAAKC,QAAQQ,KAAK,CAChBpB,SAAUkB,EAAK,GAAGG,MAAM,GACxBxB,WAAYqB,EAAK,GAAGrB,aAGtBc,EAAKE,MAAMO,KAAK,IACXF,EAAK,GACRI,OAAQJ,EAAK,GAAGG,MAAM,IAEzB,IAEH1B,EAAWe,MAAQC,CACpB,GAGH,MAAO,CAAEhB,aAAYE,aAAYC,kBAAjC,EAGF,QClDA,MACMyB,EAAa,CAAEC,MAAO,cACtBC,EAAa,CAAED,MAAO,gBACtBE,EAAa,CACjBC,IAAK,EACLH,MAAO,aAEHI,EAAa,CACjBD,IAAK,EACLH,MAAO,yBAEHK,EAAa,CACjBF,IAAK,EACLH,MAAO,aAEHM,EAAa,CACjBH,IAAK,EACLH,MAAO,aAEHO,EAAa,CACjBJ,IAAK,EACLH,MAAO,aAEHQ,EAAa,CACjBL,IAAK,EACLH,MAAO,aAgBT,OAA4BS,EAAAA,EAAAA,IAAiB,CAC3CC,OAAQ,WACRC,MAAMC,GAER,MAAMC,GAAQC,EAAAA,EAAAA,MAERX,GAAMY,EAAAA,EAAAA,IAAY,QAClB,QAAEC,EAAF,MAAWC,IAAUC,EAAAA,EAAAA,IAASf,GAE9B3B,GAAWJ,EAAAA,EAAAA,IAAmB,MAC9B+C,EAAiB,KAChBN,EAAMO,OAAO5C,UAAsC,MAA1BqC,EAAMO,OAAO5C,SAGzCA,EAASU,MAAQ2B,EAAMO,OAAO5C,SAF9BA,EAASU,MAAQ,IAEjB,GAEJmC,EAAAA,EAAAA,IAAUF,IACVG,EAAAA,EAAAA,KAAM,IAAMT,EAAMO,OAAO5C,UAAU2C,GAEnC,MAAM1C,GAAUL,EAAAA,EAAAA,IAAmB,MAC7BmD,EAAgB,KACS,KAAzBV,EAAMO,OAAO3C,QACfA,EAAQS,MAAQ,KAEhBT,EAAQS,MAAQ2B,EAAMO,OAAO3C,OAA7B,GAEJ4C,EAAAA,EAAAA,IAAUE,IACVD,EAAAA,EAAAA,KAAM,IAAMT,EAAMO,OAAO3C,SAAS8C,GAElC,MAAM,WAAEpD,EAAF,gBAAcG,GAAoBkD,IAClCC,EAAa,KACbhD,EAAQS,OACVZ,EAAgB,CACdG,QAASoC,EAAMO,OAAO3C,QACtBD,SAAUA,EAASU,OAEtB,GAEHmC,EAAAA,EAAAA,IAAUI,IACVH,EAAAA,EAAAA,IAAM,CAAC7C,EAASD,GAAWiD,GAE3B,MAAMC,GAAWC,EAAAA,EAAAA,KAAS,MAEtBX,EAAQY,MAAMC,SAAS,iCACiB,IAArCZ,EAAMa,aAAaC,OAAOC,YAI7BhB,EAAQY,MAAMC,SAAS,YAC+B,IAAnDZ,EAAMgB,UAAUC,eAAeR,SAASM,QACY,IAApDf,EAAMgB,UAAUC,eAAeC,UAAUH,WAIO,IAAnDf,EAAMgB,UAAUC,eAAeR,SAASM,SACpChB,EAAQY,MAAMC,SAAS,oCAMzBO,GAAaT,EAAAA,EAAAA,KAAS,IACnBX,EAAQY,MAAMC,SAAS,YACzBb,EAAQY,MAAMC,SAAS,kCAM9B,OAFAQ,EAAAA,EAAAA,KAAc,IAAMC,SAASC,MAAQ,kBAE9B,CAACC,EAAUC,MACRC,EAAAA,EAAAA,OAAcC,EAAAA,EAAAA,IAAoB,OAAQ5C,EAAY,EAC5D6C,EAAAA,EAAAA,KAAaC,EAAAA,EAAAA,IAAOC,EAAAA,MACnBD,EAAAA,EAAAA,IAAO1E,IAAeM,EAAQS,QAAS2D,EAAAA,EAAAA,IAAOnB,KAC1CgB,EAAAA,EAAAA,OAAcC,EAAAA,EAAAA,IAAoBI,EAAAA,GAAW,CAAE5C,IAAK,GAAK,EACxD6C,EAAAA,EAAAA,GAAoB,UAAW,CAC7BhD,OAAOiD,EAAAA,EAAAA,IAAgB,CAAC,iBAAiBJ,EAAAA,EAAAA,IAAOT,GAAc,YAAc,MAC3E,EACDQ,EAAAA,EAAAA,KAAaC,EAAAA,EAAAA,IAAOK,EAAAA,IAAgB,CAClCzE,QAASA,EAAQS,MACjBV,SAAUA,EAASU,OAClB,KAAM,EAAG,CAAC,UAAW,cACvB2D,EAAAA,EAAAA,IAAOT,KACHM,EAAAA,EAAAA,OAAcS,EAAAA,EAAAA,KAAaN,EAAAA,EAAAA,IAAOO,EAAAA,IAAgB,CACjDjD,IAAK,EACL1B,QAASA,EAAQS,MACjBV,SAAUA,EAASU,MACnBmE,UAAW5B,GACV,KAAM,EAAG,CAAC,UAAW,eACxB6B,EAAAA,EAAAA,IAAoB,IAAI,IAC3B,GACoC,KAAtCT,EAAAA,EAAAA,IAAO1E,GAAYiB,QAAQ4C,QAAsD,KAAtCa,EAAAA,EAAAA,IAAO1E,GAAYiB,QAAQ4C,SAClEU,EAAAA,EAAAA,OAAcC,EAAAA,EAAAA,IAAoBI,EAAAA,GAAW,CAAE5C,IAAK,GAAK,EACxD6C,EAAAA,EAAAA,GAAoB,UAAW/C,EAAY,GACxCyC,EAAAA,EAAAA,KAAW,IAAOC,EAAAA,EAAAA,IAAoBI,EAAAA,GAAW,MAAMQ,EAAAA,EAAAA,KAAYV,EAAAA,EAAAA,IAAO1E,GAAYiB,SAAUoE,KACvFd,EAAAA,EAAAA,OAAcS,EAAAA,EAAAA,KAAaN,EAAAA,EAAAA,IAAOY,EAAAA,IAAS,CACjDtD,IAAKqD,EAAOnF,WACZmF,OAAQA,EACR/E,QAASA,EAAQS,OAChB,KAAM,EAAG,CAAC,SAAU,eACrB,SAEL2D,EAAAA,EAAAA,IAAO1E,GAAYiB,QAAQ4C,SAAUa,EAAAA,EAAAA,IAAO1E,GAAYkB,MAAM2C,SAC1DU,EAAAA,EAAAA,OAAcC,EAAAA,EAAAA,IAAoB,MAAOzC,KAC1CoD,EAAAA,EAAAA,IAAoB,IAAI,IAC3BT,EAAAA,EAAAA,IAAO1E,KACHuE,EAAAA,EAAAA,OAAcC,EAAAA,EAAAA,IAAoB,UAAWvC,EAAY,GACvDsC,EAAAA,EAAAA,KAAW,IAAOC,EAAAA,EAAAA,IAAoBI,EAAAA,GAAW,MAAMQ,EAAAA,EAAAA,KAAYV,EAAAA,EAAAA,IAAO1E,GAAYkB,OAAQqE,KACrFhB,EAAAA,EAAAA,OAAcS,EAAAA,EAAAA,KAAaN,EAAAA,EAAAA,IAAOc,EAAAA,IAAO,CAC/CxD,IAAKuD,EAAKE,SACVF,KAAMA,GACL,KAAM,EAAG,CAAC,YACX,UAENJ,EAAAA,EAAAA,IAAoB,IAAI,IAC3B,OACFZ,EAAAA,EAAAA,OAAcC,EAAAA,EAAAA,IAAoB,MAAOtC,EAAY,wBACzD,OACDwC,EAAAA,EAAAA,IAAO1E,IAAeM,EAAQS,QAAS2D,EAAAA,EAAAA,IAAOnB,KAC7CgB,EAAAA,EAAAA,OAAcC,EAAAA,EAAAA,IAAoB,MAAOrC,EAAY,EACpDsC,EAAAA,EAAAA,KAAaC,EAAAA,EAAAA,IAAOgB,EAAAA,SAErBhB,EAAAA,EAAAA,IAAO7B,GAASY,MAAMC,SAAS,mCAAoCgB,EAAAA,EAAAA,IAAOnB,KACxEgB,EAAAA,EAAAA,OAAcC,EAAAA,EAAAA,IAAoB,MAAOpC,EAAY,6BACpDsC,EAAAA,EAAAA,IAAOnB,IAEP4B,EAAAA,EAAAA,IAAoB,IAAI,KADvBZ,EAAAA,EAAAA,OAAcC,EAAAA,EAAAA,IAAoB,MAAOnC,EAAY,yCAInE,I,SCtKD,MAAMsD,GAA2B,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBAEvE,O","sources":["webpack://mark/./src/pages/OurCloud/hooks/useFolderInfo.ts","webpack://mark/./src/pages/OurCloud/OurCloud.vue?59be","webpack://mark/./src/pages/OurCloud/OurCloud.vue"],"sourcesContent":["import { ref } from 'vue'\r\nimport { useFetch, IError } from '@/shared'\r\nimport { store } from '@/store'\r\nimport { IFolderInfo } from '@/features/cloud/types'\r\n\r\ninterface Params {\r\n  folderID: number | null | string,\r\n  groupID: number | string\r\n}\r\n\r\n// переименовать в folderInfo\r\nconst useCloudInfo = () => {\r\n  const folderInfo = ref<IFolderInfo | null>(null)\r\n  const folderName = ref<string | null>(null)\r\n\r\n  const fetchFolderInfo = async ({ folderID, groupID }: Params) => {\r\n    const { response, error } = await useFetch({\r\n      path: 'markMethods/groupCloud.getFiles',\r\n      data: folderID\r\n        ? { groupID, folderID }\r\n        : { groupID }\r\n    })\r\n\r\n    if (error) {\r\n      store.dispatch('setError', error as IError)\r\n      console.log(error)\r\n    } else {\r\n      folderName.value = response.folderName\r\n      const info: IFolderInfo = {\r\n        folders: [],\r\n        files: []\r\n      }\r\n      Object.entries(response.content).forEach((item: any[]) => {\r\n        if (item[0].startsWith('folder_')) {\r\n          //info.folders.push(item[0].slice(6))\r\n          info.folders.push({\r\n            folderID: item[0].slice(7) as number,\r\n            folderName: item[1].folderName as string\r\n          })\r\n        } else {\r\n          info.files.push({\r\n            ...item[1],\r\n            fileID: item[0].slice(5)\r\n          })\r\n        }\r\n      })\r\n      folderInfo.value = info\r\n    }\r\n  }\r\n\r\n  return { folderInfo, folderName, fetchFolderInfo }\r\n}\r\n\r\nexport default useCloudInfo\r\n","import { defineComponent as _defineComponent } from 'vue'\nimport { unref as _unref, createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, normalizeClass as _normalizeClass, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-08927b0c\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = { class: \"cloud-page\" }\nconst _hoisted_2 = { class: \"content-grid\" }\nconst _hoisted_3 = {\n  key: 0,\n  class: \"separator\"\n}\nconst _hoisted_4 = {\n  key: 1,\n  class: \"content-grid --margin\"\n}\nconst _hoisted_5 = {\n  key: 1,\n  class: \"no-groups\"\n}\nconst _hoisted_6 = {\n  key: 1,\n  class: \"no-groups\"\n}\nconst _hoisted_7 = {\n  key: 2,\n  class: \"no-groups\"\n}\nconst _hoisted_8 = {\n  key: 3,\n  class: \"no-groups\"\n}\n\nimport {\r\n  ref, onBeforeMount, onMounted, watch, computed, inject\r\n} from 'vue'\r\nimport { Key } from '@/store'\r\nimport { useStore } from 'vuex'\r\nimport { useRoute } from 'vue-router'\r\nimport {\r\n  CloudNav, DirectoryPath, CloudControls, Folder, File\r\n} from '@/features/cloud'\r\nimport { Loader } from '@/shared'\r\nimport useFolderInfo from './hooks/useFolderInfo'\r\n\r\n\nexport default /*#__PURE__*/_defineComponent({\n  __name: 'OurCloud',\n  setup(__props) {\n\r\nconst route = useRoute()\r\n\r\nconst key = inject<Key>('key')\r\nconst { getters, state } = useStore(key)\r\n\r\nconst folderID = ref<string | null>(null)\r\nconst updateFolderID = () => {\r\n  if (!route.params.folderID || route.params.folderID === '0')\r\n    folderID.value = null\r\n  else\r\n    folderID.value = route.params.folderID as string\r\n}\r\nonMounted(updateFolderID)\r\nwatch(() => route.params.folderID, updateFolderID)\r\n\r\nconst groupID = ref<string | null>(null)\r\nconst updateGroupID = () => {\r\n  if (route.params.groupID === '')\r\n    groupID.value = null\r\n  else\r\n    groupID.value = route.params.groupID as string\r\n}\r\nonMounted(updateGroupID)\r\nwatch(() => route.params.groupID, updateGroupID)\r\n\r\nconst { folderInfo, fetchFolderInfo } = useFolderInfo()\r\nconst updateInfo = () => {\r\n  if (groupID.value) {\r\n    fetchFolderInfo({\r\n      groupID: route.params.groupID as string,\r\n      folderID: folderID.value\r\n    })\r\n  }\r\n}\r\nonMounted(updateInfo)\r\nwatch([groupID, folderID], updateInfo)\r\n\r\nconst inGroups = computed(() => {\r\n  if (\r\n    getters.roles.includes('administrator_of_institution')\r\n    && state.institution?.groups.length === 0\r\n  ) return false\r\n\r\n  if (\r\n    getters.roles.includes('teacher')\r\n    && state.userInfo?.additionalData.inGroups.length === 0\r\n    && state.userInfo?.additionalData.ownGroups.length === 0\r\n  ) return false\r\n\r\n  if (\r\n    state.userInfo?.additionalData.inGroups.length === 0\r\n    && !getters.roles.includes('administrator_of_institution')\r\n  ) return false\r\n\r\n  return true\r\n})\r\n\r\nconst authorized = computed(() => {\r\n  return getters.roles.includes('teacher')\r\n    || getters.roles.includes('administrator_of_institution')\r\n})\r\n\r\n// eslint-disable-next-line\r\nonBeforeMount(() => document.title = 'Облако группы')\r\n\nreturn (_ctx: any,_cache: any) => {\n  return (_openBlock(), _createElementBlock(\"main\", _hoisted_1, [\n    _createVNode(_unref(CloudNav)),\n    (_unref(folderInfo) && groupID.value && _unref(inGroups))\n      ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n          _createElementVNode(\"section\", {\n            class: _normalizeClass([\"cloud-heading\", _unref(authorized) ? 'hide-path' : ''])\n          }, [\n            _createVNode(_unref(DirectoryPath), {\n              groupID: groupID.value,\n              folderID: folderID.value\n            }, null, 8, [\"groupID\", \"folderID\"]),\n            (_unref(authorized))\n              ? (_openBlock(), _createBlock(_unref(CloudControls), {\n                  key: 0,\n                  groupID: groupID.value,\n                  folderID: folderID.value,\n                  onCreated: updateInfo\n                }, null, 8, [\"groupID\", \"folderID\"]))\n              : _createCommentVNode(\"\", true)\n          ], 2),\n          (_unref(folderInfo).folders.length !== 0 && _unref(folderInfo).folders.length !== 0)\n            ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                _createElementVNode(\"section\", _hoisted_2, [\n                  (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(folderInfo).folders, (folder) => {\n                    return (_openBlock(), _createBlock(_unref(Folder), {\n                      key: folder.folderName,\n                      folder: folder,\n                      groupID: groupID.value\n                    }, null, 8, [\"folder\", \"groupID\"]))\n                  }), 128))\n                ]),\n                (_unref(folderInfo).folders.length && _unref(folderInfo).files.length)\n                  ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3))\n                  : _createCommentVNode(\"\", true),\n                (_unref(folderInfo))\n                  ? (_openBlock(), _createElementBlock(\"section\", _hoisted_4, [\n                      (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(folderInfo).files, (file) => {\n                        return (_openBlock(), _createBlock(_unref(File), {\n                          key: file.fileName,\n                          file: file\n                        }, null, 8, [\"file\"]))\n                      }), 128))\n                    ]))\n                  : _createCommentVNode(\"\", true)\n              ], 64))\n            : (_openBlock(), _createElementBlock(\"div\", _hoisted_5, \" Директория пуста \"))\n        ], 64))\n      : (!_unref(folderInfo) && groupID.value && _unref(inGroups))\n        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [\n            _createVNode(_unref(Loader))\n          ]))\n        : (_unref(getters).roles.includes('administrator_of_institution') && !_unref(inGroups))\n          ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, \" Группы еще не созданы \"))\n          : (!_unref(inGroups))\n            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, \" Вы не состоите ни в одной группе \"))\n            : _createCommentVNode(\"\", true)\n  ]))\n}\n}\n\n})","import script from \"./OurCloud.vue?vue&type=script&lang=ts&setup=true\"\nexport * from \"./OurCloud.vue?vue&type=script&lang=ts&setup=true\"\n\nimport \"./OurCloud.vue?vue&type=style&index=0&id=08927b0c&lang=scss&scoped=true\"\n\nimport exportComponent from \"G:\\\\Programming\\\\Apps\\\\mark\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-08927b0c\"]])\n\nexport default __exports__"],"names":["useCloudInfo","folderInfo","ref","folderName","fetchFolderInfo","async","folderID","groupID","response","error","useFetch","path","data","store","console","log","value","info","folders","files","Object","entries","content","forEach","item","startsWith","push","slice","fileID","_hoisted_1","class","_hoisted_2","_hoisted_3","key","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_defineComponent","__name","setup","__props","route","useRoute","inject","getters","state","useStore","updateFolderID","params","onMounted","watch","updateGroupID","useFolderInfo","updateInfo","inGroups","computed","roles","includes","institution","groups","length","userInfo","additionalData","ownGroups","authorized","onBeforeMount","document","title","_ctx","_cache","_openBlock","_createElementBlock","_createVNode","_unref","CloudNav","_Fragment","_createElementVNode","_normalizeClass","DirectoryPath","_createBlock","CloudControls","onCreated","_createCommentVNode","_renderList","folder","Folder","file","File","fileName","Loader","__exports__"],"sourceRoot":""}