{"version":3,"file":"js/55.f1677138.js","mappings":"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","sources":["webpack://mark/./src/pages/EditReport/hooks/useReport.ts","webpack://mark/./src/pages/EditReport/EditReport.vue?ca2e","webpack://mark/./src/pages/EditReport/EditReport.vue"],"sourcesContent":["import { ref } from 'vue'\r\nimport { RouteLocationNormalizedLoaded } from 'vue-router'\r\nimport { store } from '@/store'\r\nimport { useFetch, IError } from '@/shared'\r\nimport { IReportInfo, useTime } from '@/features/reports'\r\n\r\ninterface IParams {\r\n  route: RouteLocationNormalizedLoaded\r\n}\r\n\r\nconst useReport = ({ route }: IParams) => {\r\n  const report = ref<IReportInfo | null>(null)\r\n\r\n  const fetchReport = async () => {\r\n    const { response, error } = await useFetch({\r\n      path: 'markMethods/attendance.getAttendanceReportsInfo',\r\n      data: {\r\n        reportsIDs: route.params.reportID\r\n      }\r\n    })\r\n\r\n    const { setTime } = useTime()\r\n\r\n    if (error) {\r\n      console.log(error)\r\n      store.dispatch('setError', error as IError)\r\n    } else {\r\n      report.value = setTime(response[0] as IReportInfo)\r\n    }\r\n  }\r\n\r\n  return { report, fetchReport }\r\n}\r\n\r\nexport default useReport\r\n","import { defineComponent as _defineComponent } from 'vue'\nimport { unref as _unref, createVNode as _createVNode, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, Fragment as _Fragment, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\nimport _imports_0 from '@/assets/tabler-sprite.svg'\n\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-e51c24e6\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = _imports_0 + '#tabler-arrow-left'\nconst _hoisted_2 = _imports_0 + '#tabler-device-floppy'\nconst _hoisted_3 = {\n  key: 0,\n  class: \"nav\"\n}\nconst _hoisted_4 = { class: \"title-group\" }\nconst _hoisted_5 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"svg\", {\n  width: \"24\",\n  height: \"24\",\n  viewBox: \"0 0 24 24\"\n}, [\n  /*#__PURE__*/_createElementVNode(\"use\", { href: _hoisted_1 })\n], -1))\nconst _hoisted_6 = [\n  _hoisted_5\n]\nconst _hoisted_7 = { class: \"heading\" }\nconst _hoisted_8 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"svg\", {\n  width: \"24\",\n  height: \"24\",\n  viewBox: \"0 0 24 24\"\n}, [\n  /*#__PURE__*/_createElementVNode(\"use\", { href: _hoisted_2 })\n], -1))\nconst _hoisted_9 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", null, \"Сохранить\", -1))\nconst _hoisted_10 = [\n  _hoisted_8,\n  _hoisted_9\n]\nconst _hoisted_11 = {\n  key: 1,\n  class: \"main\"\n}\nconst _hoisted_12 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"svg\", {\n  width: \"24\",\n  height: \"24\",\n  viewBox: \"0 0 24 24\"\n}, [\n  /*#__PURE__*/_createElementVNode(\"use\", { href: _hoisted_2 })\n], -1))\nconst _hoisted_13 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", null, \"Сохранить\", -1))\nconst _hoisted_14 = [\n  _hoisted_12,\n  _hoisted_13\n]\n\nimport {\r\n  onMounted, watch, ref, inject, onBeforeMount\r\n} from 'vue'\r\nimport { Key, IGroupInfo } from '@/store'\r\nimport { useStore } from 'vuex'\r\nimport { useRouter, useRoute } from 'vue-router'\r\nimport { useFetch, IError, Alert } from '@/shared'\r\nimport { ReportUsers, IResponseAttendance } from '@/features/reports'\r\nimport useReport from './hooks/useReport'\r\n\r\n\nexport default /*#__PURE__*/_defineComponent({\n  __name: 'EditReport',\n  setup(__props) {\n\r\nconst key = inject<Key>('key')\r\nconst { dispatch, getters, state } = useStore(key)\r\n\r\nconst route = useRoute()\r\nconst router = useRouter()\r\n\r\nconst { report, fetchReport } = useReport({ route })\r\n\r\nonMounted(fetchReport)\r\nwatch(() => route.params.reportID, fetchReport)\r\n\r\nconst groupInfo = ref<IGroupInfo | null>(null)\r\nwatch([report, () => state.groups], () => {\r\n  if (!report.value) return\r\n  groupInfo.value = getters.getGroups(report.value.groupID)\r\n})\r\n\r\nconst attendance = ref<IResponseAttendance[] | null>(null)\r\nwatch(report, () => {\r\n  if (report.value) {\r\n    attendance.value = report.value.students.map(s => ({\r\n      userID: s.userID,\r\n      firstName: s.firstName,\r\n      lastName: s.lastName,\r\n      patronymic: s.patronymic,\r\n      isPresent: s.isPresent,\r\n      status: s.status\r\n    } as IResponseAttendance))\r\n  }\r\n})\r\n\r\nconst updateAttendance = (userID: number | string) => {\r\n  if (!attendance.value) return\r\n  attendance.value = attendance.value.map(user => {\r\n    if (user.userID === userID)\r\n      return { ...user, isPresent: !user.isPresent }\r\n    else\r\n      return user\r\n  })\r\n}\r\n\r\nconst checkStatus = (userID: number | string) => {\r\n  /* eslint-disable */\r\n  if (!groupInfo.value) return\r\n  if (typeof userID === 'string') return\r\n  if (groupInfo.value.headStudentID === userID) return 'Староста'\r\n  if (groupInfo.value.deputyHeadStudentID === userID) return 'Зам. старосты'\r\n  return\r\n  /* eslint-enable */\r\n}\r\n\r\nconst message = ref('')\r\nconst messageCount = ref(0)\r\n\r\nconst editReport = async () => {\r\n  if (!attendance.value) return\r\n\r\n  const presentStudents = attendance.value\r\n    .filter(s => s.isPresent).map(s => s.userID)\r\n  const missingStudents = attendance.value\r\n    .filter(s => !s.isPresent).map(s => s.userID)\r\n\r\n  const { error } = await useFetch({\r\n    path: 'markMethods/attendance.editAttendanceReport',\r\n    data: {\r\n      reportID: route.params.reportID,\r\n      presentStudents,\r\n      missingStudents\r\n    }\r\n  })\r\n\r\n  if (error) {\r\n    console.log(error)\r\n    dispatch('setError', error as IError)\r\n  } else {\r\n    message.value = 'Отчет изменен!'\r\n    messageCount.value += 1\r\n  }\r\n}\r\n\r\nonBeforeMount(() => document.title = 'Редактировать отчет')\r\n\nreturn (_ctx: any,_cache: any) => {\n  return (_openBlock(), _createElementBlock(_Fragment, null, [\n    _createVNode(_unref(Alert), {\n      text: message.value,\n      observer: messageCount.value\n    }, null, 8, [\"text\", \"observer\"]),\n    (_unref(report))\n      ? (_openBlock(), _createElementBlock(\"nav\", _hoisted_3, [\n          _createElementVNode(\"div\", _hoisted_4, [\n            (_unref(router).options.history.state.back)\n              ? (_openBlock(), _createElementBlock(\"button\", {\n                  key: 0,\n                  class: \"back-button\",\n                  onClick: _cache[0] || (_cache[0] = ($event: any) => (_unref(router).go(-1)))\n                }, _hoisted_6))\n              : _createCommentVNode(\"\", true),\n            _createElementVNode(\"h1\", _hoisted_7, [\n              _createElementVNode(\"span\", null, _toDisplayString(_unref(report).date), 1),\n              _createElementVNode(\"span\", null, _toDisplayString(_unref(report).groupName), 1),\n              _createElementVNode(\"span\", null, _toDisplayString(_unref(report).institutionData.shortName), 1)\n            ])\n          ]),\n          _createElementVNode(\"button\", {\n            class: \"save-button --desktop\",\n            onClick: editReport\n          }, _hoisted_10)\n        ]))\n      : _createCommentVNode(\"\", true),\n    (attendance.value)\n      ? (_openBlock(), _createElementBlock(\"main\", _hoisted_11, [\n          _createElementVNode(\"div\", { class: \"mobile-controls\" }, [\n            _createElementVNode(\"button\", {\n              class: \"save-button\",\n              onClick: editReport\n            }, _hoisted_14)\n          ]),\n          _createVNode(_unref(ReportUsers), {\n            \"users-data\": attendance.value,\n            \"check-status\": checkStatus,\n            onEdit: updateAttendance\n          }, null, 8, [\"users-data\"])\n        ]))\n      : _createCommentVNode(\"\", true)\n  ], 64))\n}\n}\n\n})","import script from \"./EditReport.vue?vue&type=script&lang=ts&setup=true\"\nexport * from \"./EditReport.vue?vue&type=script&lang=ts&setup=true\"\n\nimport \"./EditReport.vue?vue&type=style&index=0&id=e51c24e6&lang=scss&scoped=true\"\n\nimport exportComponent from \"G:\\\\Programming\\\\Apps\\\\mark\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-e51c24e6\"]])\n\nexport default __exports__"],"names":["useReport","route","report","ref","fetchReport","async","response","error","useFetch","path","data","reportsIDs","params","reportID","setTime","useTime","console","log","store","value","_withScopeId","n","_pushScopeId","_popScopeId","_hoisted_1","_imports_0","_hoisted_2","_hoisted_3","key","class","_hoisted_4","_hoisted_5","_createElementVNode","width","height","viewBox","href","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_defineComponent","__name","setup","__props","inject","dispatch","getters","state","useStore","useRoute","router","useRouter","onMounted","watch","groupInfo","groups","getGroups","groupID","attendance","students","map","s","userID","firstName","lastName","patronymic","isPresent","status","updateAttendance","user","checkStatus","headStudentID","deputyHeadStudentID","message","messageCount","editReport","presentStudents","filter","missingStudents","onBeforeMount","document","title","_ctx","_cache","_openBlock","_createElementBlock","_Fragment","_createVNode","_unref","Alert","text","observer","options","history","back","onClick","$event","go","_createCommentVNode","_toDisplayString","date","groupName","institutionData","shortName","ReportUsers","onEdit","__exports__"],"sourceRoot":""}